function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var f=a.apply(b,c);function g(a){asyncGeneratorStep(f,d,e,g,h,"next",a)}function h(a){asyncGeneratorStep(f,d,e,g,h,"throw",a)}g(void 0)})}}define ("mod_minilesson/quizhelper",["jquery","core/log","mod_minilesson/definitions","core/templates","core/ajax","mod_minilesson/dictation","mod_minilesson/dictationchat","mod_minilesson/multichoice","mod_minilesson/multiaudio","mod_minilesson/speechcards","mod_minilesson/listenrepeat","mod_minilesson/page","mod_minilesson/smartframe","mod_minilesson/shortanswer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";b.debug("MiniLesson Quiz helper: initialising");return{spliton_regexp:new RegExp(/([!"# $%&'()。「」、*+,-.\/:;<=>?@[\]^_`{|}~])/,"g"),nopunc_regexp:new RegExp(/[!"#$%&'()。「」、*+,-.\/:;<=>?@[\]^_`{|}~]/,"g"),nonspaces_regexp:new RegExp(/[^ ]/,"g"),autoplaydelay:800,controls:{},submitbuttonclass:"mod_minilesson_quizsubmitbutton",stepresults:[],init:function init(a,b,c,d,e){this.quizdata=b.quizdata;this.region=b.region;this.ttslanguage=b.ttslanguage;this.controls.quizcontainer=a;this.attemptid=d;this.courseurl=b.courseurl;this.cmid=c;this.reattempturl=b.reattempturl;this.activityurl=b.activityurl;this.backtocourse=b.backtocourse;this.ds_only=b.ds_only;this.prepare_html();this.init_questions(this.quizdata,e);this.register_events();this.start_quiz()},prepare_html:function prepare_html(){this.controls.quizfinished=a("#mod_minilesson_quiz_finished")},init_questions:function init_questions(b,d){var e=this;a.each(b,function(a,b){switch(b.type){case c.qtype_dictation:f.clone().init(a,b,e,d);break;case c.qtype_dictationchat:g.clone().init(a,b,e,d);break;case c.qtype_multichoice:h.clone().init(a,b,e);break;case c.qtype_multiaudio:i.clone().init(a,b,e);break;case c.qtype_speechcards:j.clone().init(a,b,e);break;case c.qtype_listenrepeat:k.clone().init(a,b,e);break;case c.qtype_page:l.clone().init(a,b,e);break;case c.qtype_smartframe:m.clone().init(a,b,e);break;case c.qtype_shortanswer:n.clone().init(a,b,e);break;}});a("audio.mod_minilesson_itemttsaudio").each(function(){var b=this;d.fetch_polly_url(a(this).data("text"),a(this).data("ttsoption"),a(this).data("voice")).then(function(c){a(b).attr("src",c)})})},register_events:function register_events(){a("."+this.submitbuttonclass).on("click",function(){})},render_quiz_progress:function render_quiz_progress(b,c){for(var d=[],e=0;e<c;e++){d.push(e)}if(6>c){var f=d.slice(0,5),g="width: "+(100-100/f.length)+"%; margin-left: auto; margin-right: auto",h="<div class='minilesson_quiz_progress_line' style='"+g+"'></div>";f.forEach(function(a){h+="<div class='minilesson_quiz_progress_item "+(a==b?"minilesson_quiz_progress_item_current":"")+" "+(a<b?"minilesson_quiz_progress_item_completed":"")+"'>"+(a+1)+"</div>"})}else{if(b>c-6){var f=d.slice(c-5,c-1)}else{var f=d.slice(b,b+4)}if(0==b){var g="width: 80%; margin-left: auto; margin-right: auto"}else{var g="width: "+(100-100/(2*f.length))+"%; margin-left: 0"}var h="<div class='minilesson_quiz_progress_line' style='"+g+"'></div>";f.forEach(function(a){h+="<div class='minilesson_quiz_progress_item "+(a==b?"minilesson_quiz_progress_item_current":"")+" "+(a<b?"minilesson_quiz_progress_item_completed":"")+"'>"+(a+1)+"</div>"});h+="<div class='minilesson_quiz_progress_finalitem'>"+c+"</div>"}h+="";a(".minilesson_quiz_progress").html(h)},do_next:function(){var d=_asyncToGenerator(regeneratorRuntime.mark(function d(e){var f,g,h,i,j,k,l,m;return regeneratorRuntime.wrap(function(d){while(1){switch(d.prev=d.next){case 0:f=this;g=e.index;h=this.quizdata[g];if(!(!0===h.preview)){d.next=5;break}return d.abrupt("return");case 5:b.debug("reporting step grade");d.next=8;return f.report_step_grade(e);case 8:b.debug("reported step grade");i=a("#"+h.uniqueid+"_container");i.hide();if(!(f.quizdata.length>g+1)){d.next=23;break}j=g+1;k=this.quizdata[j];a("#"+k.uniqueid+"_container").show();d.t0=k.type;d.next=d.t0===c.qtype_speechcards?18:d.t0===c.qtype_dictation?19:d.t0===c.qtype_dictationchat?19:d.t0===c.qtype_multichoice?19:d.t0===c.qtype_multiaudio?19:d.t0===c.qtype_listenrepeat?19:d.t0===c.qtype_smartframe?19:d.t0===c.qtype_shortanswer?19:19;break;case 18:return d.abrupt("break",19);case 19:l=a("#"+k.uniqueid+"_container audio.mod_minilesson_itemttsaudio");if("1"==l.data("autoplay")){m=this;setTimeout(function(){l[0].play()},m.autoplaydelay)}d.next=26;break;case 23:a(".minilesson_nextbutton").prop("disabled",!0);setTimeout(function(){b.debug("forwarding to finished page");window.location.href=f.activityurl},1e3);return d.abrupt("return");case 26:this.render_quiz_progress(e.index+1,this.quizdata.length);i.remove();case 28:case"end":return d.stop();}}},d,this)}));return function do_next(){return d.apply(this,arguments)}}(),report_step_grade:function(){var a=_asyncToGenerator(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:c=this;this.stepresults.push(b);a.next=4;return e.call([{methodname:"mod_minilesson_report_step_grade",args:{cmid:c.cmid,step:JSON.stringify(b)}}]);case 4:case"end":return a.stop();}}},a,this)}));return function report_step_grade(){return a.apply(this,arguments)}}(),start_quiz:function start_quiz(){a("#"+this.quizdata[0].uniqueid+"_container").show();var b=a("#"+this.quizdata[0].uniqueid+"_container audio.mod_minilesson_itemttsaudio");if("1"==b.data("autoplay")){var c=this;setTimeout(function(){b[0].play()},c.autoplaydelay)}this.render_quiz_progress(0,this.quizdata.length)},onSubmit:function onSubmit(){alert("quiz submitted. Override this")},mobile_user:function mobile_user(){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){return!0}else{return!1}},chrome_user:function chrome_user(){if(/Chrome/i.test(navigator.userAgent)){return!0}else{return!1}},use_ttrecorder:function use_ttrecorder(){return!0},is_ds_only:function is_ds_only(){return this.ds_only},similarity:function similarity(a,b){a=a.replace(/\s+/g,"");b=b.replace(/\s+/g,"");var c=a,d=b;if(a.length<b.length){c=b;d=a}var e=c.length;if(0==e){return 100}return 100*((e-this.editDistance(c,d))/parseFloat(e))},editDistance:function editDistance(a,b){a=a.toLowerCase();b=b.toLowerCase();for(var c=[],d=0,e;d<=a.length;d++){e=d;for(var f=0;f<=b.length;f++){if(0==d)c[f]=f;else{if(0<f){var g=c[f-1];if(a.charAt(d-1)!=b.charAt(f-1))g=Math.min(Math.min(g,e),c[f])+1;c[f-1]=e;e=g}}}if(0<d)c[b.length]=e}return c[b.length]},cleanText:function cleanText(a){var b=a.toLowerCase(),c=b.replace(this.nopunc_regexp,""),d=c.replace(/\s+/g," ").trim();return d},checkByPhonetic:function checkByPhonetic(a,b,c,d){return e.call([{methodname:"mod_minilesson_check_by_phonetic",args:{spoken:b,correct:a,language:d,phonetic:c,region:this.region,cmid:this.cmid}}])[0]},comparePassageToTranscript:function comparePassageToTranscript(a,b,c,d){return e.call([{methodname:"mod_minilesson_compare_passage_to_transcript",args:{passage:a,transcript:b,alternatives:"",phonetic:c,language:d,region:this.region,cmid:this.cmid}}])[0]}}});
//# sourceMappingURL=quizhelper.min.js.map
